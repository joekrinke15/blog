---
layout: post
title: A Malaria Data Challenge
full-width: true
image: https://www.hhmi.org/sites/default/files/news/2020/malaria-parasite-infecting-red-blood-cells_1600x1200.jpg
---
# The Malaria Epidemic Through the Ages
In this post I'll be participating in TidyTuesday, a weekly event where you're challenged to analyze a new dataset. This week's dataset is on malaria- a parasitic illness that is spread by mosquito bites. In 2018 there were approximately 228 million cases of malaria worldwide, leading to an estimated 405,000 deaths. Better understanding the incidence of malaria and its associated patient demographics could allow for better prevention of the disease. 
<p align="center">
  <img src="https://www.aljazeera.com/mritems/imagecache/mbdxxlarge/mritems/Images/2018/4/24/8a469872b46c4956855d23f56e6f210e_18.jpg">
</p>

The data I'll be analyzing consists of three different datasets: one on the malarial death rate per 100k people, one on the number of deaths by age group, and one on the rate of malaria cases per 1000 at-risk individuals. 
Each dataset has observations for each country over the course of varying time frames. Let's begin by reading in the data.

```python3
# Read in data
mal_age = pd.read_csv('malaria_deaths_age.csv')
mal_death = pd.read_csv('malaria_deaths.txt')
mal_gen = pd.read_csv('malaria_inc.csv')
# Look at first few rows 
mal_death.head()
```
It looks like some of the column names are a bit long- let's rename them. It also appears that there is an entry for world for each year of observations. I don't plan on using this field, so I'm going to remove it.

```python3
# Rename Columns
mal_death = mal_death.rename(columns = {'Deaths - Malaria - Sex: Both - Age: Age-standardized (Rate) (per 100,000 people)': 'Malaria Deaths per 100k'})
mal_gen = mal_gen.rename(columns = {'Incidence of malaria (per 1,000 population at risk) (per 1,000 population at risk)' : 'Malaria Cases Per 1000 at Risk'})

# Drop world from entity list for each dataset
mal_age = mal_age[mal_age['entity'] != 'World']
mal_death = mal_death[mal_death['Entity'] != 'World']
mal_gen = mal_gen[mal_gen['Entity'] != 'World']
```
Now that we've cleaned up our data, let's see how the rates of deaths due to malaria have changed over time. I wrote some code below to produce a dynamic graph of the death rate.
```python3
# Create dynamic plot of malaria deaths over time
fig = px.choropleth(mal_death, locations= 'Code',
                     hover_name="Entity",
                     animation_frame="Year",
                     projection="natural earth",
                     color = 'Malaria Deaths per 100k',
                     color_continuous_scale='Portland',
                     range_color = (0,200))
fig.update_geos(fitbounds="locations", visible=False)
fig.update_layout(title ={'text':'Malaria Deaths per 100k', 'x':.50})
fig.show()
```

<p align="center">
  <img src="https://raw.githubusercontent.com/joekrinke15/JoeKrinke15.github.io/master/img/WorldMalaria.gif">
</p>

It appears that Africa has been the country hardest-hit by malaria. However, the rate of deaths has dropped in recent years. It may be that social or demographic changes are driving the change in overall deaths; let's examine trends in deaths by age group to see if this is true.

```python3
# Sum the deaths over each age group and year
age_group = mal_age.groupby(by = ['year', 'age_group']).sum()

# Find the proportion of deaths attributable to each age group
age_group['death_proportion'] = age_group['deaths']/mal_age.groupby(by = ['year']).sum()['deaths']
age_group = age_group.reset_index()

#Plot a graph to show cumulative deaths by age group
fig2 = px.area(age_group, x = 'year', y = 'deaths', color= 'age_group', labels={
                     "year": "Year",
                     "age_group": 'Age Group',
                     'deaths' : 'Total Deaths'})

fig2.update_layout(
    title={
        'text': "Yearly Malaria Deaths by Age Group",
        'y':.95,
        'x':0.5,
        'xanchor': 'center',
        'yanchor': 'top'})

fig2.show()
```
<p align="center">
  <img src="https://raw.githubusercontent.com/joekrinke15/JoeKrinke15.github.io/master/img/MalariaDeathsAge.PNG">
</p>

This graph allows one to see broad overall trends in deaths by age group, but it's hard to accurately estimate the exact proportion of deaths in each age group. Let's try looking at a chart that uses percentages rather than absolute numbers.

```python3
# Create graph using relative proportion instead of absolute deaths
fig = px.bar(age_group, x="year", y= 'death_proportion', 
            color='age_group',
            labels={
                     "year": "Year",
                     "age_group": 'Age Group',
                     'deaths' : 'Total Deaths',
                     'death_proportion': 'Percent of Total Deaths'})
fig.update_layout(
    title={
        'text': "Yearly Malaria Death Proportions by Age Group",
        'y':.95,
        'x':0.5,
        'xanchor': 'center',
        'yanchor': 'top'})
fig.show()
```
<p align="center">
  <img src="https://raw.githubusercontent.com/joekrinke15/JoeKrinke15.github.io/master/img/MalariaPropAgeRate.PNG">
</p>
The breakdown of who dies of malaria is constant across years. Children under the age of 5 are the majority of those who die from malaria, followed by people ages 5-14 and 50-69. It's interesting that the disease doesn't seem to kill many elderly people. It may be that people who are already elderly are likely to have some form of malarial immunity that allowed them to survive to old age. This could be a genetic mutation, like sickle-cell anemia, or perhaps acquired immunity after a prior malarial attack.

# What's the relationship between cases and deaths?

Another interesting question is if the relationship between the incidence of malaria (measured as cases per 1000 at-risk) and deaths (measured  as deaths per 100k people) has changed over time. Such a change could indicate that the quality of medical care in areas where malaria is endemic is getting better. The code below produces an interactive plot that shows death rate and malaria incidence for various time periods.

```python3
# Merge together data on death rate and malarial incidence
merged_data = pd.merge(mal_gen, mal_death, how = 'left')

# Subset data by Year
merge_2000 = merged_data[merged_data['Year'] == 2000]
merge_2005 = merged_data[merged_data['Year'] == 2005]
merge_2010 = merged_data[merged_data['Year'] == 2010]
merge_2015 = merged_data[merged_data['Year'] == 2015]

fig = go.Figure()

# Create a trace for each year of interest
#2000
fig.add_trace(
    go.Scatter(x=list(merge_2000['Malaria Cases Per 1000 at Risk']),
               y=list(merge_2000['Malaria Deaths per 100k']),
               name="2000",mode ='markers',marker = dict(color='orange')))
#2005
fig.add_trace(
    go.Scatter(x=list(merge_2005['Malaria Cases Per 1000 at Risk']),
               y=list(merge_2005['Malaria Deaths per 100k']),
               name="2005",mode ='markers', marker = dict(color='red')))
#2010
fig.add_trace(
    go.Scatter(x=list(merge_2010['Malaria Cases Per 1000 at Risk']),
               y=list(merge_2010['Malaria Deaths per 100k']),
               name="2010",mode ='markers', marker = dict(color='green')))
#2015
fig.add_trace(
    go.Scatter(x=list(merge_2015['Malaria Cases Per 1000 at Risk']),
               y=list(merge_2015['Malaria Deaths per 100k']),
               name="2015", mode ='markers', marker = dict(color='blue')))

#add buttons

fig.update_layout(
    updatemenus=[
        dict(
            active=0,
            buttons=list([
                dict(label="2000",
                     method="update",
                     args=[{"visible": [True, False, False, False]},
                           {"title": "Malaria Deaths and At-Risk Case Rate: 2000"}]),
                dict(label="2005",
                     method="update",
                     args=[{"visible": [False, True, False, False]},
                           {"title": "Malaria Deaths and At-Risk Case Rate: 2005"}]),
                dict(label="2010",
                     method="update",
                     args=[{"visible": [False, False, True, False]},
                           {"title": "Malaria Deaths and At-Risk Case Rate: 2010"}]),
                dict(label="2015",
                     method="update",
                     args=[{"visible": [False, False, False, True]},
                           {"title": "Malaria Deaths and At-Risk Case Rate: 2015"}]),
                dict(label="All Years",
                     method="update",
                     args=[{"visible": [True, True, True, True]},
                           {"title": "Malaria Deaths and At-Risk Case Rate Per Year"}]),
            ]),
        )
    ])

# Set title
fig.update_layout(title_text="Malaria Deaths and At-Risk Case Rate per Year", 
                  title_x = .50,
                  yaxis_title="Deaths Per 100k",
                  xaxis_title="Cases Per 1000 at Risk")

fig.show()
```
<p align="center">
  <img src="https://raw.githubusercontent.com/joekrinke15/JoeKrinke15.github.io/master/img/CaseRateDaths.gif">
</p>
There seems to be a linear relationship between the case rate and the death rate overall. This makes perfect sense - the correlation between the two seems obvious. However, when you break it down by year, you can see that this relationship between the variables changes. Every year but 2000 seems to have a linear pattern. That year exhibits an almost exponential relationship; it may be that large numbers of cases overwhelm the health system, thereby causing the number of deaths to disproportionately increase. It would be interesting to examine what was happening in 2000 to find the ultimate cause.

# Sources

[Malaria Data](https://github.com/rfordatascience/tidytuesday/tree/master/data/2018/2018-11-13)

[Developing Malarial Immunity](https://www.cdc.gov/parasites/malaria/index.html)

[Malaria Facts](https://www.who.int/news-room/fact-sheets/detail/malaria)
